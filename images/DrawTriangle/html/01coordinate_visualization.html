<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenGL åæ ‡ç³»ç»Ÿå¯è§†åŒ–</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            gap: 40px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border: 2px solid #333;
            background: white;
        }
        h3 {
            margin: 10px 0;
            color: #333;
            font-size: 16px;
        }
        .description {
            max-width: 900px;
            margin: 20px auto;
            padding: 15px;
            background: #e8f4f8;
            border-left: 4px solid #2196F3;
            border-radius: 5px;
        }
        .description h4 {
            margin-top: 0;
            color: #1976D2;
        }
        .description p {
            margin: 5px 0;
            line-height: 1.6;
            color: #333;
        }
        .export-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .export-btn:hover {
            background-color: #1976D2;
        }
        .export-btn:active {
            background-color: #0D47A1;
        }
    </style>
</head>
<body>
    <div class="description">
        <h4>ğŸ“Œ ä»€ä¹ˆæ˜¯ NDC (Normalized Device Coordinates)?</h4>
        <p><strong>NDCï¼ˆæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼‰</strong>æ˜¯ OpenGL çš„æ ‡å‡†åæ ‡ç³»ç»Ÿï¼š</p>
        <p>â€¢ åæ ‡èŒƒå›´å›ºå®šåœ¨ <strong>[-1.0, 1.0]</strong> ä¹‹é—´ï¼ˆXã€Yã€Z è½´éƒ½æ˜¯ï¼‰</p>
        <p>â€¢ åŸç‚¹ (0, 0) ä½äº<strong>å±å¹•ä¸­å¿ƒ</strong>ï¼Œè€Œéå·¦ä¸Šè§’</p>
        <p>â€¢ è¶…å‡º [-1, 1] èŒƒå›´çš„åæ ‡ä¼šè¢«è£å‰ªæ‰ï¼ˆä¸æ˜¾ç¤ºï¼‰</p>
        <p>â€¢ è¿™æ˜¯ä¸€ä¸ªä¸è®¾å¤‡æ— å…³çš„åæ ‡ç³»ç»Ÿï¼Œæ— è®ºå±å¹•åˆ†è¾¨ç‡å¦‚ä½•éƒ½ä¿æŒä¸€è‡´</p>
    </div>

    <div class="container">
        <div class="canvas-wrapper">
            <h3>OpenGL æ ‡å‡†åŒ–è®¾å¤‡åæ ‡ (NDC)</h3>
            <canvas id="ndc-canvas" width="400" height="400"></canvas>
            <button class="export-btn" onclick="exportCanvas('ndc-canvas', 'NDCåæ ‡ç³»')">å¯¼å‡ºå›¾ç‰‡</button>
        </div>
        <div class="canvas-wrapper">
            <h3>ä¸‰è§’å½¢åœ¨ NDC åæ ‡ç³»ä¸­</h3>
            <canvas id="triangle-canvas" width="400" height="400"></canvas>
            <button class="export-btn" onclick="exportCanvas('triangle-canvas', 'ä¸‰è§’å½¢NDC')">å¯¼å‡ºå›¾ç‰‡</button>
        </div>
    </div>

    <script>
        // ç»˜åˆ¶ç¬¬ä¸€ä¸ªç”»å¸ƒï¼šç©ºåæ ‡ç³»
        function drawNDCCoordinates() {
            const canvas = document.getElementById('ndc-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const gridSize = 40; // æ¯ä¸ªæ ¼å­çš„å¤§å°

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;

            for (let i = 0; i <= width; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }

            for (let i = 0; i <= height; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;

            // Xè½´
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();

            // Yè½´
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();

            // ç»˜åˆ¶ç®­å¤´
            drawArrow(ctx, width - 10, centerY, width, centerY); // Xè½´ç®­å¤´
            drawArrow(ctx, centerX, 10, centerX, 0); // Yè½´ç®­å¤´

            // æ ‡æ³¨åæ ‡ç‚¹
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // åŸç‚¹
            ctx.fillText('(0, 0)', centerX - 25, centerY + 20);

            // Xè½´æ ‡æ³¨
            ctx.fillText('(-1, 0)', 30, centerY + 20);
            ctx.fillText('(1, 0)', width - 30, centerY + 20);

            // Yè½´æ ‡æ³¨
            ctx.fillText('(0, 1)', centerX + 30, 20);
            ctx.fillText('(0, -1)', centerX + 35, height - 20);
        }

        // ç»˜åˆ¶ç¬¬äºŒä¸ªç”»å¸ƒï¼šå¸¦ä¸‰è§’å½¢çš„åæ ‡ç³»
        function drawTriangle() {
            const canvas = document.getElementById('triangle-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const gridSize = 40;
            const scale = 200; // NDCåæ ‡åˆ°åƒç´ çš„ç¼©æ”¾æ¯”ä¾‹

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;

            for (let i = 0; i <= width; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }

            for (let i = 0; i <= height; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();

            drawArrow(ctx, width - 10, centerY, width, centerY);
            drawArrow(ctx, centerX, 10, centerX, 0);

            // ä¸‰è§’å½¢é¡¶ç‚¹åæ ‡ (NDC)
            const vertices = [
                { x: 0.0, y: 0.5 },    // é¡¶ç‚¹1
                { x: -0.5, y: -0.5 },  // é¡¶ç‚¹2
                { x: 0.5, y: -0.5 }    // é¡¶ç‚¹3
            ];

            // è½¬æ¢ä¸ºç”»å¸ƒåæ ‡å¹¶ç»˜åˆ¶ä¸‰è§’å½¢
            ctx.fillStyle = 'rgba(180, 180, 180, 0.6)';
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;

            ctx.beginPath();
            vertices.forEach((v, i) => {
                const x = centerX + v.x * scale;
                const y = centerY - v.y * scale; // Yè½´åè½¬
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // æ ‡æ³¨é¡¶ç‚¹åæ ‡
            ctx.fillStyle = '#333';
            ctx.font = '13px Arial';

            vertices.forEach((v, i) => {
                const x = centerX + v.x * scale;
                const y = centerY - v.y * scale;

                // ç»˜åˆ¶é¡¶ç‚¹åœ†ç‚¹
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#ff0000';
                ctx.fill();

                // æ ‡æ³¨æ–‡å­—
                ctx.fillStyle = '#333';
                let offsetX = 0, offsetY = 0;
                if (i === 0) { // é¡¶ç‚¹1 - ä¸Šæ–¹
                    offsetX = 5;
                    offsetY = -10;
                } else if (i === 1) { // é¡¶ç‚¹2 - å·¦ä¸‹
                    offsetX = -68;
                    offsetY = 10;
                } else { // é¡¶ç‚¹3 - å³ä¸‹
                    offsetX = 10;
                    offsetY = 10;
                }
                ctx.fillText(`(${v.x}, ${v.y})`, x + offsetX, y + offsetY);
            });

            // ç§»é™¤é‡å¤çš„åæ ‡æ ‡æ³¨ï¼ˆå·²ç»åœ¨ä¸Šé¢çš„forEachä¸­æ ‡æ³¨äº†ï¼‰
        }

        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headLength = 10;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle - Math.PI / 6),
                toY - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle + Math.PI / 6),
                toY - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.stroke();
        }

        // åˆå§‹åŒ–ç»˜åˆ¶
        drawNDCCoordinates();
        drawTriangle();

        // å¯¼å‡ºCanvasä¸ºé«˜æ¸…å›¾ç‰‡
        function exportCanvas(canvasId, fileName) {
            const originalCanvas = document.getElementById(canvasId);
            const scale = 3; // 3å€åˆ†è¾¨ç‡ï¼Œæé«˜æ¸…æ™°åº¦

            // åˆ›å»ºä¸€ä¸ªæ–°çš„é«˜åˆ†è¾¨ç‡Canvas
            const exportCanvas = document.createElement('canvas');
            exportCanvas.width = originalCanvas.width * scale;
            exportCanvas.height = originalCanvas.height * scale;
            const ctx = exportCanvas.getContext('2d');

            // æ·»åŠ ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);

            // ç¼©æ”¾ä¸Šä¸‹æ–‡ä»¥æé«˜æ¸…æ™°åº¦
            ctx.scale(scale, scale);

            // è®¾ç½®é«˜è´¨é‡æ¸²æŸ“
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';

            // å°†åŸCanvaså†…å®¹ç»˜åˆ¶åˆ°æ–°Canvasä¸Š
            ctx.drawImage(originalCanvas, 0, 0);

            // è½¬æ¢ä¸ºPNGæ ¼å¼ (qualityå‚æ•°å¯¹PNGæ— æ•ˆï¼Œä½†ä¿ç•™ä»¥ä¾¿å°†æ¥åˆ‡æ¢åˆ°JPEG)
            const imageData = exportCanvas.toDataURL('image/png');

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const downloadLink = document.createElement('a');
            downloadLink.href = imageData;
            downloadLink.download = `${fileName}.png`;

            // è§¦å‘ä¸‹è½½
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
    </script>
</body>
</html>